generator client {
  provider = "prisma-client"
  output   = "../src/lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  ADMIN
  USER
}

enum MerchantType {
  CPF
  CNPJ
}

enum MerchantStatus {
  ACTIVE
  INACTIVE
}

enum ChargeStatus {
  PENDING
  PAID
  FAILED
  CANCELED
  REFUNDED
}

enum ApiKeyStatus {
  ACTIVE
  INACTIVE
}

// usuario
model User {
  id String @id @default(uuid())

  email        String   @unique
  passwordHash String
  role         UserRole @default(USER)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  merchant Merchant?

  @@map("users")
}

// logista
model Merchant {
  id String @id @default(uuid())

  name         String
  email        String
  phone        String
  document     String         @unique
  documentType MerchantType   @default(CNPJ) @map("document_type")
  status       MerchantStatus @default(ACTIVE)
  metadata     Json?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  apikey  Apikey[]
  charges Charges[]

  @@index([userId])
  @@map("merchants")
}

// cliente
model Customer {
  id String @id @default(uuid())

  name         String
  email        String       @unique
  phone        String
  document     String       @unique
  documentType MerchantType
  metadata     Json?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  charges Charges[]

  @@map("customers")
}

// cobran√ßa
model Charges {
  id String @id @default(uuid())

  amount      Int
  description String

  status      ChargeStatus @default(PENDING)

  qrCode      String
  expiresIn   Int
  metadata    Json?

  merchantId String
  merchant   Merchant @relation(fields: [merchantId], references: [id], onDelete: Cascade)

  customerId String
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("charges")
}

// apikey
model Apikey {
  id String @id @default(uuid())

  name        String
  value       String       @unique
  description String
  status      ApiKeyStatus @default(ACTIVE)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  merchantId String
  merchant   Merchant @relation(fields: [merchantId], references: [id], onDelete: Cascade)

  @@map("apikeys")
}
